
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Search - Speech Tagger &#8212; VowpalWabbit latest documentation</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nav.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../reference/index.html" />
    <link rel="prev" title="Search - Sequence" href="search_sequence.html" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <div class="navbar_container main_nav_container">
  <div class="container nav_wrapper">
    <div class="logo">
      <a href="https://vowpalwabbit.org/index.html">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="172px" height="30px" viewBox="0 0 172 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 57.1 (83088) - https://sketch.com -->
    <title>logo_vw_horiz_gray</title>
    <desc>Created with Sketch.</desc>
    <g id="Styles" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Desktop-Copy" transform="translate(-944.000000, -314.000000)">
            <g id="logo_vw_horiz_gray" transform="translate(941.000000, 314.000000)">
                <rect id="framework" x="0" y="0" width="175" height="30"></rect>
                <path d="M49.488,22 L46.59,22 L42.252,10.12 L44.88,10.12 L47.382,17.68 L48.066,20.02 L48.732,17.698 L51.252,10.12 L53.808,10.12 L49.488,22 Z M58.524,12.82 C59.9760073,12.82 61.106996,13.2339959 61.917,14.062 C62.7270041,14.8900041 63.132,16.0359927 63.132,17.5 C63.132,18.9640073 62.7270041,20.1099959 61.917,20.938 C61.106996,21.7660041 59.9760073,22.18 58.524,22.18 C57.0719927,22.18 55.9410041,21.7660041 55.131,20.938 C54.320996,20.1099959 53.916,18.9640073 53.916,17.5 C53.916,16.0359927 54.320996,14.8900041 55.131,14.062 C55.9410041,13.2339959 57.0719927,12.82 58.524,12.82 Z M58.524,14.656 C57.8279965,14.656 57.2970018,14.8929976 56.931,15.367 C56.5649982,15.8410024 56.382,16.5519953 56.382,17.5 C56.382,18.4480047 56.5649982,19.1589976 56.931,19.633 C57.2970018,20.1070024 57.8279965,20.344 58.524,20.344 C59.2200035,20.344 59.7509982,20.1070024 60.117,19.633 C60.4830018,19.1589976 60.666,18.4480047 60.666,17.5 C60.666,16.5519953 60.4830018,15.8410024 60.117,15.367 C59.7509982,14.8929976 59.2200035,14.656 58.524,14.656 Z M79.368,13 L76.506,22 L73.644,22 L71.682,15.646 L69.792,22 L66.948,22 L64.086,13 L66.696,13 L68.496,20.02 L70.512,13 L72.942,13 L74.958,20.02 L76.758,13 L79.368,13 Z M86.316,12.82 C87.516006,12.82 88.4579966,13.2309959 89.142,14.053 C89.8260034,14.8750041 90.168,16.0179927 90.168,17.482 C90.168,18.9580074 89.8260034,20.1099959 89.142,20.938 C88.4579966,21.7660041 87.516006,22.18 86.316,22.18 C85.6679968,22.18 85.1040024,22.0330015 84.624,21.739 C84.1439976,21.4449985 83.7660014,21.0400026 83.49,20.524 L83.49,25.78 L81.024,25.78 L81.024,13 L83.202,13 L83.292,14.782 C83.5560013,14.181997 83.9489974,13.7050018 84.471,13.351 C84.9930026,12.9969982 85.6079965,12.82 86.316,12.82 Z M85.578,20.29 C86.2500034,20.29 86.7719981,20.0500024 87.144,19.57 C87.5160019,19.0899976 87.702,18.4000045 87.702,17.5 C87.702,16.5999955 87.5160019,15.9100024 87.144,15.43 C86.7719981,14.9499976 86.2500034,14.71 85.578,14.71 C84.977997,14.71 84.4920019,14.9169979 84.12,15.331 C83.7479981,15.7450021 83.5380002,16.3359962 83.49,17.104 L83.49,17.896 C83.5380002,18.6520038 83.7479981,19.2399979 84.12,19.66 C84.4920019,20.0800021 84.977997,20.29 85.578,20.29 Z M100.518,20.506 C100.770001,20.506 100.973999,20.4820002 101.13,20.434 L100.95,21.928 C100.613998,22.0960008 100.224002,22.18 99.78,22.18 C98.6279942,22.18 97.9380011,21.7300045 97.71,20.83 C97.4459987,21.2740022 97.0380028,21.6099989 96.486,21.838 C95.9339972,22.0660011 95.2800038,22.18 94.524,22.18 C93.6479956,22.18 92.9640025,21.982002 92.472,21.586 C91.9799975,21.189998 91.734,20.6200037 91.734,19.876 C91.734,18.4119927 92.9039883,17.4640022 95.244,17.032 L97.404,16.618 L97.404,16.186 C97.404,15.7059976 97.2690014,15.3250014 96.999,15.043 C96.7289987,14.7609986 96.3540024,14.62 95.874,14.62 C95.3219972,14.62 94.8720017,14.7399988 94.524,14.98 C94.1759983,15.2200012 93.9360007,15.6099973 93.804,16.15 L91.842,15.322 C92.034001,14.5419961 92.4659966,13.9300022 93.138,13.486 C93.8100034,13.0419978 94.6859946,12.82 95.766,12.82 C97.0500064,12.82 98.0519964,13.0989972 98.772,13.657 C99.4920036,14.2150028 99.852,15.0399945 99.852,16.132 L99.852,19.822 C99.852,20.0620012 99.9059995,20.2359995 100.014,20.344 C100.122001,20.4520005 100.289999,20.506 100.518,20.506 Z M95.298,20.506 C95.8260026,20.506 96.3089978,20.3770013 96.747,20.119 C97.1850022,19.8609987 97.404,19.5100022 97.404,19.066 L97.404,18.13 L95.478,18.562 C95.069998,18.6580005 94.767001,18.7869992 94.569,18.949 C94.370999,19.1110008 94.272,19.3359986 94.272,19.624 C94.272,19.9120014 94.3619991,20.1309992 94.542,20.281 C94.7220009,20.4310007 94.9739984,20.506 95.298,20.506 Z M105.054,19.138 C105.054,19.5700022 105.116999,19.8699992 105.243,20.038 C105.369001,20.2060008 105.599998,20.29 105.936,20.29 C106.140001,20.29 106.316999,20.2750001 106.467,20.245 C106.617001,20.2149998 106.793999,20.1640004 106.998,20.092 L106.782,21.802 C106.589999,21.9220006 106.338002,22.0149997 106.026,22.081 C105.713998,22.1470003 105.408002,22.18 105.108,22.18 C104.231996,22.18 103.593002,21.9670021 103.191,21.541 C102.788998,21.1149979 102.588,20.4340047 102.588,19.498 L102.588,9.058 L105.054,9.058 L105.054,19.138 Z M118.482,22 L115.62,22 L112.164,10.12 L114.846,10.12 L117.15,20.038 L119.526,10.12 L121.902,10.12 L124.314,20.038 L126.618,10.12 L129.174,10.12 L125.718,22 L122.928,22 L121.272,15.52 L120.714,12.712 L120.678,12.712 L120.12,15.52 L118.482,22 Z M138.336,20.506 C138.588001,20.506 138.791999,20.4820002 138.948,20.434 L138.768,21.928 C138.431998,22.0960008 138.042002,22.18 137.598,22.18 C136.445994,22.18 135.756001,21.7300045 135.528,20.83 C135.263999,21.2740022 134.856003,21.6099989 134.304,21.838 C133.751997,22.0660011 133.098004,22.18 132.342,22.18 C131.465996,22.18 130.782002,21.982002 130.29,21.586 C129.797998,21.189998 129.552,20.6200037 129.552,19.876 C129.552,18.4119927 130.721988,17.4640022 133.062,17.032 L135.222,16.618 L135.222,16.186 C135.222,15.7059976 135.087001,15.3250014 134.817,15.043 C134.546999,14.7609986 134.172002,14.62 133.692,14.62 C133.139997,14.62 132.690002,14.7399988 132.342,14.98 C131.993998,15.2200012 131.754001,15.6099973 131.622,16.15 L129.66,15.322 C129.852001,14.5419961 130.283997,13.9300022 130.956,13.486 C131.628003,13.0419978 132.503995,12.82 133.584,12.82 C134.868006,12.82 135.869996,13.0989972 136.59,13.657 C137.310004,14.2150028 137.67,15.0399945 137.67,16.132 L137.67,19.822 C137.67,20.0620012 137.723999,20.2359995 137.832,20.344 C137.940001,20.4520005 138.107999,20.506 138.336,20.506 Z M133.116,20.506 C133.644003,20.506 134.126998,20.3770013 134.565,20.119 C135.003002,19.8609987 135.222,19.5100022 135.222,19.066 L135.222,18.13 L133.296,18.562 C132.887998,18.6580005 132.585001,18.7869992 132.387,18.949 C132.188999,19.1110008 132.09,19.3359986 132.09,19.624 C132.09,19.9120014 132.179999,20.1309992 132.36,20.281 C132.540001,20.4310007 132.791998,20.506 133.116,20.506 Z M145.734,12.82 C146.934006,12.82 147.875997,13.2339959 148.56,14.062 C149.244003,14.8900041 149.586,16.0419926 149.586,17.518 C149.586,18.9820073 149.244003,20.1249959 148.56,20.947 C147.875997,21.7690041 146.934006,22.18 145.734,22.18 C145.025996,22.18 144.411003,22.0030018 143.889,21.649 C143.366997,21.2949982 142.974001,20.818003 142.71,20.218 L142.62,22 L140.442,22 L140.442,9.058 L142.908,9.058 L142.908,14.476 C143.184001,13.9599974 143.561998,13.5550015 144.042,13.261 C144.522002,12.9669985 145.085997,12.82 145.734,12.82 Z M144.996,20.29 C145.668003,20.29 146.189998,20.0500024 146.562,19.57 C146.934002,19.0899976 147.12,18.4000045 147.12,17.5 C147.12,16.5999955 146.934002,15.9100024 146.562,15.43 C146.189998,14.9499976 145.668003,14.71 144.996,14.71 C144.395997,14.71 143.910002,14.9199979 143.538,15.34 C143.165998,15.7600021 142.956,16.3479962 142.908,17.104 L142.908,17.896 C142.956,18.6640038 143.165998,19.2549979 143.538,19.669 C143.910002,20.0830021 144.395997,20.29 144.996,20.29 Z M157.056,12.82 C158.256006,12.82 159.197997,13.2339959 159.882,14.062 C160.566003,14.8900041 160.908,16.0419926 160.908,17.518 C160.908,18.9820073 160.566003,20.1249959 159.882,20.947 C159.197997,21.7690041 158.256006,22.18 157.056,22.18 C156.347996,22.18 155.733003,22.0030018 155.211,21.649 C154.688997,21.2949982 154.296001,20.818003 154.032,20.218 L153.942,22 L151.764,22 L151.764,9.058 L154.23,9.058 L154.23,14.476 C154.506001,13.9599974 154.883998,13.5550015 155.364,13.261 C155.844002,12.9669985 156.407997,12.82 157.056,12.82 Z M156.318,20.29 C156.990003,20.29 157.511998,20.0500024 157.884,19.57 C158.256002,19.0899976 158.442,18.4000045 158.442,17.5 C158.442,16.5999955 158.256002,15.9100024 157.884,15.43 C157.511998,14.9499976 156.990003,14.71 156.318,14.71 C155.717997,14.71 155.232002,14.9199979 154.86,15.34 C154.487998,15.7600021 154.278,16.3479962 154.23,17.104 L154.23,17.896 C154.278,18.6640038 154.487998,19.2549979 154.86,19.669 C155.232002,20.0830021 155.717997,20.29 156.318,20.29 Z M164.328,11.704 C163.307995,11.704 162.798,11.2660044 162.798,10.39 C162.798,9.50199556 163.307995,9.058 164.328,9.058 C165.348005,9.058 165.858,9.50199556 165.858,10.39 C165.858,11.2660044 165.348005,11.704 164.328,11.704 Z M165.552,22 L163.086,22 L163.086,13 L165.552,13 L165.552,22 Z M174.336,21.442 C174.047999,21.6700011 173.685002,21.8499993 173.247,21.982 C172.808998,22.1140007 172.350002,22.18 171.87,22.18 C169.86599,22.18 168.864,21.2740091 168.864,19.462 L168.864,14.836 L167.226,14.836 L167.226,13 L168.864,13 L168.864,10.93 L171.33,10.246 L171.33,13 L174.246,13 L174.246,14.836 L171.33,14.836 L171.33,19.066 C171.33,19.8940041 171.743996,20.308 172.572,20.308 C173.100003,20.308 173.561998,20.1400017 173.958,19.804 L174.336,21.442 Z" id="VowpalWabbit" fill="#333333" fill-rule="nonzero"></path>
                <g id="logo_vw_color" transform="translate(3.000000, 0.000000)" fill="#2A3B93">
                    <path d="M27.9875518,16.6117194 C27.9875518,9.21947752 21.9666728,9.36035971 21.9666728,9.36035971 C21.3736977,6.15536974 20.3362508,3.5963294 19.3414955,1.96947553 C18.1790857,0.436543115 17.3241355,0 17.3241355,0 C16.2887633,0.700737156 15.7766231,3.93943024 15.7766231,3.93943024 C14.1726939,1.18184505 12.329851,1.05294263 12.329851,1.05294263 C9.93824094,8.37466357 17.0427696,11.1203489 17.0427696,11.1203489 C9.97542657,11.1203489 6.33307087,15.0400524 4.59284756,17.9877167 C4.0042614,19.0524794 3.60319929,20.0302689 3.35048069,20.7371557 L2.99801525,21.8605394 C1.89952322,21.2108361 0.011355398,21.1878349 0.011355398,21.1878349 C-0.278708419,29.2136474 5.0845596,28.0167877 5.0845596,28.0167877 C5.0845596,29.1432063 6.56177043,30 6.56177043,30 L18.0978518,30 C18.0978518,30 17.9248509,28.5478912 16.7183131,27.7616983 C16.5196972,27.4693917 16.4533057,27.212705 16.6897456,26.9422016 C17.354698,26.1816454 17.8296525,27.1798804 17.8296525,27.1798804 L18.3302221,27.8553801 C19.7539686,29.627988 20.7440159,29.9516816 21.1646284,30 L21.391732,30 C20.5763614,27.5009384 20.6054875,25.3190215 20.6054875,25.3190215 C20.4822802,22.1365535 22.8107704,19.2166024 22.8107704,19.2166024 C28.5084697,19.2166024 27.9875518,16.6117194 27.9875518,16.6117194" id="logo_rabbit"></path>
                </g>
            </g>
        </g>
    </g>
</svg>
      </a>
    </div>

    <div class="nav">
      <a href="https://vowpalwabbit.org/start.html">
        Get started
      </a>
      <a href="https://vowpalwabbit.org/features.html">
        Features
      </a>
      <a href="https://vowpalwabbit.org/tutorials.html">
        Tutorials
      </a>
      <a href="https://vowpalwabbit.org/blog.html">
        Blog
      </a>
      <a href="https://vowpalwabbit.org/research.html">
        Research
      </a>
      <div class="external_links">
        <a class="active" href="index.html">
          Docs
        </a>

        <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki" target="_blank">
          Wiki
        </a>

        <a href="https://github.com/VowpalWabbit/vowpal_wabbit" target="_blank" class="github_link">
          <?xml version="1.0" encoding="UTF-8"?>
<svg width="30px" height="30px" viewBox="0 0 30 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
    <title>GitHub</title>
    <desc>Created with Sketch.</desc>
    <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="HD_Desktop_header_Home" transform="translate(-1538.000000, -58.000000)" fill="#FFFFFF">
            <g id="Header">
                <path d="M1568,73.7951128 C1567.94603,74.2583723 1567.89891,74.7224863 1567.83682,75.1847206 C1567.56271,77.2238487 1566.86543,79.1138828 1565.7732,80.8526868 C1564.55268,82.7956941 1562.9969,84.4188114 1561.05088,85.6538569 C1560.03339,86.2996179 1558.94817,86.8066231 1557.80753,87.1895684 C1557.17559,87.4016322 1556.73848,87.0743943 1556.73531,86.4093237 C1556.72907,85.1020808 1556.73745,83.7947524 1556.73164,82.487424 C1556.72804,81.6908602 1556.64825,80.9063436 1556.21259,80.2087201 C1556.0855,80.0052003 1555.92463,79.8226135 1555.77393,79.6234512 C1556.35935,79.5140871 1556.9463,79.4362506 1557.51632,79.2916849 C1559.04696,78.9034423 1560.41543,78.2275208 1561.34791,76.8924242 C1562.03287,75.9115647 1562.34632,74.7851144 1562.48436,73.6108172 C1562.59169,72.6982249 1562.62222,71.7826422 1562.42971,70.8740656 C1562.23608,69.9599354 1561.84044,69.1418405 1561.22834,68.4359293 C1561.07756,68.2620575 1561.04763,68.1215929 1561.12221,67.896713 C1561.52468,66.6818314 1561.3562,65.491984 1560.9042,64.3262309 C1560.87829,64.2595017 1560.76574,64.1973008 1560.68569,64.1853391 C1560.15364,64.1058793 1559.65196,64.2559986 1559.18533,64.4761793 C1558.42904,64.8332361 1557.69764,65.242668 1556.9487,65.6159585 C1556.82229,65.6790137 1556.64782,65.7219904 1556.51706,65.6889249 C1554.16941,65.0964789 1551.82595,65.097077 1549.47805,65.6883268 C1549.34078,65.7228448 1549.14638,65.677134 1549.02331,65.5987849 C1548.07109,64.9919849 1547.06446,64.5120644 1545.97001,64.2236166 C1545.9511,64.218661 1545.93272,64.2115694 1545.91364,64.2077246 C1545.22551,64.0670892 1545.09971,64.1456947 1544.9036,64.8108506 C1544.58682,65.884755 1544.5296,66.9550708 1544.90668,68.0296587 C1544.93627,68.1139033 1544.90129,68.2616303 1544.8404,68.3306664 C1543.60397,69.7341156 1543.31096,71.3989279 1543.46559,73.1936101 C1543.55933,74.2817831 1543.81162,75.3262104 1544.29869,76.3083514 C1544.97176,77.6654063 1546.11181,78.4952066 1547.4926,78.982475 C1548.35956,79.2884382 1549.27852,79.4473579 1550.18824,79.6758264 C1550.19526,79.6319098 1550.20056,79.6666842 1550.18568,79.6820635 C1549.71726,80.1697591 1549.45556,80.755028 1549.34531,81.4170227 C1549.33137,81.5007546 1549.27365,81.6203716 1549.20685,81.6454912 C1548.16482,82.0372369 1547.11706,82.2433199 1546.08683,81.6149888 C1545.61867,81.3295314 1545.27683,80.9169382 1545.00101,80.4479541 C1544.56852,79.712395 1543.95864,79.179074 1543.13923,78.9361661 C1542.84434,78.8487602 1542.50823,78.8709748 1542.19359,78.8892591 C1541.97909,78.9018189 1541.90862,79.062362 1542.05256,79.2422147 C1542.18529,79.4077988 1542.32025,79.5950849 1542.4978,79.6971865 C1543.28625,80.1507913 1543.72798,80.8753286 1544.08881,81.6641173 C1544.30382,82.1341266 1544.48812,82.6140471 1544.88675,82.9753759 C1545.52169,83.5510755 1546.29115,83.7682658 1547.11612,83.8044072 C1547.81434,83.834995 1548.51496,83.8107298 1549.24722,83.8107298 C1549.24611,83.8009041 1549.26073,83.8742123 1549.26167,83.9476058 C1549.27211,84.7377616 1549.2828,85.5279173 1549.28844,86.3180731 C1549.294,87.0913115 1548.82935,87.4109452 1548.0952,87.1563319 C1544.28705,85.8355039 1541.4928,83.3342269 1539.62819,79.7992882 C1538.22405,77.1372118 1537.78027,74.2780237 1538.09739,71.2935795 C1538.4294,68.1688416 1539.66702,65.4337134 1541.73193,63.0872551 C1543.89022,60.6347648 1546.57714,59.0045559 1549.78825,58.3523869 C1554.45335,57.4048494 1558.71409,58.3562318 1562.44442,61.3515269 C1565.27245,63.6222848 1567.02271,66.5767393 1567.72914,70.1361141 C1567.83314,70.6605492 1567.87265,71.197715 1567.94398,71.7286436 C1567.95792,71.832625 1567.9811,71.9354102 1568,72.0387934 L1568,73.7951128 Z" id="GitHub"></path>
            </g>
        </g>
    </g>
</svg>
          <div>
            GitHub
          </div>
        </a>
      </div>
    </div>
  </div>
</div>
    <div class="navbar_container mobile_nav_container">
  <div class="container nav_wrapper">
    <div class="hamburger_icon">
      <?xml version="1.0" encoding="UTF-8"?>
<svg width="18px" height="16px" viewBox="0 0 18 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: sketchtool 57.1 (101010) - https://sketch.com -->
    <title>8049A6A1-2687-43E9-9B5D-E205E8F9E871</title>
    <desc>Created with sketchtool.</desc>
    <g id="Pages" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
        <g id="Mobile_home" transform="translate(-12.000000, -56.000000)" stroke="#FFFFFF" stroke-width="2">
            <g id="header">
                <g id="ui_header_mobile_dk" transform="translate(12.000000, 44.000000)">
                    <g id="icon_menu" transform="translate(1.000000, 12.500000)">
                        <g id="Line">
                            <path d="M16,0.5 L0,0.5"></path>
                            <path d="M16,7.5 L0,7.5"></path>
                            <path d="M16,14.5 L0,14.5"></path>
                        </g>
                    </g>
                </g>
            </g>
        </g>
    </g>
</svg>
    </div>
    <div class="logo">
      <a href="https://vowpalwabbit.org/index.html">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="172px" height="30px" viewBox="0 0 172 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 57.1 (83088) - https://sketch.com -->
    <title>logo_vw_horiz_gray</title>
    <desc>Created with Sketch.</desc>
    <g id="Styles" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Desktop-Copy" transform="translate(-944.000000, -314.000000)">
            <g id="logo_vw_horiz_gray" transform="translate(941.000000, 314.000000)">
                <rect id="framework" x="0" y="0" width="175" height="30"></rect>
                <path d="M49.488,22 L46.59,22 L42.252,10.12 L44.88,10.12 L47.382,17.68 L48.066,20.02 L48.732,17.698 L51.252,10.12 L53.808,10.12 L49.488,22 Z M58.524,12.82 C59.9760073,12.82 61.106996,13.2339959 61.917,14.062 C62.7270041,14.8900041 63.132,16.0359927 63.132,17.5 C63.132,18.9640073 62.7270041,20.1099959 61.917,20.938 C61.106996,21.7660041 59.9760073,22.18 58.524,22.18 C57.0719927,22.18 55.9410041,21.7660041 55.131,20.938 C54.320996,20.1099959 53.916,18.9640073 53.916,17.5 C53.916,16.0359927 54.320996,14.8900041 55.131,14.062 C55.9410041,13.2339959 57.0719927,12.82 58.524,12.82 Z M58.524,14.656 C57.8279965,14.656 57.2970018,14.8929976 56.931,15.367 C56.5649982,15.8410024 56.382,16.5519953 56.382,17.5 C56.382,18.4480047 56.5649982,19.1589976 56.931,19.633 C57.2970018,20.1070024 57.8279965,20.344 58.524,20.344 C59.2200035,20.344 59.7509982,20.1070024 60.117,19.633 C60.4830018,19.1589976 60.666,18.4480047 60.666,17.5 C60.666,16.5519953 60.4830018,15.8410024 60.117,15.367 C59.7509982,14.8929976 59.2200035,14.656 58.524,14.656 Z M79.368,13 L76.506,22 L73.644,22 L71.682,15.646 L69.792,22 L66.948,22 L64.086,13 L66.696,13 L68.496,20.02 L70.512,13 L72.942,13 L74.958,20.02 L76.758,13 L79.368,13 Z M86.316,12.82 C87.516006,12.82 88.4579966,13.2309959 89.142,14.053 C89.8260034,14.8750041 90.168,16.0179927 90.168,17.482 C90.168,18.9580074 89.8260034,20.1099959 89.142,20.938 C88.4579966,21.7660041 87.516006,22.18 86.316,22.18 C85.6679968,22.18 85.1040024,22.0330015 84.624,21.739 C84.1439976,21.4449985 83.7660014,21.0400026 83.49,20.524 L83.49,25.78 L81.024,25.78 L81.024,13 L83.202,13 L83.292,14.782 C83.5560013,14.181997 83.9489974,13.7050018 84.471,13.351 C84.9930026,12.9969982 85.6079965,12.82 86.316,12.82 Z M85.578,20.29 C86.2500034,20.29 86.7719981,20.0500024 87.144,19.57 C87.5160019,19.0899976 87.702,18.4000045 87.702,17.5 C87.702,16.5999955 87.5160019,15.9100024 87.144,15.43 C86.7719981,14.9499976 86.2500034,14.71 85.578,14.71 C84.977997,14.71 84.4920019,14.9169979 84.12,15.331 C83.7479981,15.7450021 83.5380002,16.3359962 83.49,17.104 L83.49,17.896 C83.5380002,18.6520038 83.7479981,19.2399979 84.12,19.66 C84.4920019,20.0800021 84.977997,20.29 85.578,20.29 Z M100.518,20.506 C100.770001,20.506 100.973999,20.4820002 101.13,20.434 L100.95,21.928 C100.613998,22.0960008 100.224002,22.18 99.78,22.18 C98.6279942,22.18 97.9380011,21.7300045 97.71,20.83 C97.4459987,21.2740022 97.0380028,21.6099989 96.486,21.838 C95.9339972,22.0660011 95.2800038,22.18 94.524,22.18 C93.6479956,22.18 92.9640025,21.982002 92.472,21.586 C91.9799975,21.189998 91.734,20.6200037 91.734,19.876 C91.734,18.4119927 92.9039883,17.4640022 95.244,17.032 L97.404,16.618 L97.404,16.186 C97.404,15.7059976 97.2690014,15.3250014 96.999,15.043 C96.7289987,14.7609986 96.3540024,14.62 95.874,14.62 C95.3219972,14.62 94.8720017,14.7399988 94.524,14.98 C94.1759983,15.2200012 93.9360007,15.6099973 93.804,16.15 L91.842,15.322 C92.034001,14.5419961 92.4659966,13.9300022 93.138,13.486 C93.8100034,13.0419978 94.6859946,12.82 95.766,12.82 C97.0500064,12.82 98.0519964,13.0989972 98.772,13.657 C99.4920036,14.2150028 99.852,15.0399945 99.852,16.132 L99.852,19.822 C99.852,20.0620012 99.9059995,20.2359995 100.014,20.344 C100.122001,20.4520005 100.289999,20.506 100.518,20.506 Z M95.298,20.506 C95.8260026,20.506 96.3089978,20.3770013 96.747,20.119 C97.1850022,19.8609987 97.404,19.5100022 97.404,19.066 L97.404,18.13 L95.478,18.562 C95.069998,18.6580005 94.767001,18.7869992 94.569,18.949 C94.370999,19.1110008 94.272,19.3359986 94.272,19.624 C94.272,19.9120014 94.3619991,20.1309992 94.542,20.281 C94.7220009,20.4310007 94.9739984,20.506 95.298,20.506 Z M105.054,19.138 C105.054,19.5700022 105.116999,19.8699992 105.243,20.038 C105.369001,20.2060008 105.599998,20.29 105.936,20.29 C106.140001,20.29 106.316999,20.2750001 106.467,20.245 C106.617001,20.2149998 106.793999,20.1640004 106.998,20.092 L106.782,21.802 C106.589999,21.9220006 106.338002,22.0149997 106.026,22.081 C105.713998,22.1470003 105.408002,22.18 105.108,22.18 C104.231996,22.18 103.593002,21.9670021 103.191,21.541 C102.788998,21.1149979 102.588,20.4340047 102.588,19.498 L102.588,9.058 L105.054,9.058 L105.054,19.138 Z M118.482,22 L115.62,22 L112.164,10.12 L114.846,10.12 L117.15,20.038 L119.526,10.12 L121.902,10.12 L124.314,20.038 L126.618,10.12 L129.174,10.12 L125.718,22 L122.928,22 L121.272,15.52 L120.714,12.712 L120.678,12.712 L120.12,15.52 L118.482,22 Z M138.336,20.506 C138.588001,20.506 138.791999,20.4820002 138.948,20.434 L138.768,21.928 C138.431998,22.0960008 138.042002,22.18 137.598,22.18 C136.445994,22.18 135.756001,21.7300045 135.528,20.83 C135.263999,21.2740022 134.856003,21.6099989 134.304,21.838 C133.751997,22.0660011 133.098004,22.18 132.342,22.18 C131.465996,22.18 130.782002,21.982002 130.29,21.586 C129.797998,21.189998 129.552,20.6200037 129.552,19.876 C129.552,18.4119927 130.721988,17.4640022 133.062,17.032 L135.222,16.618 L135.222,16.186 C135.222,15.7059976 135.087001,15.3250014 134.817,15.043 C134.546999,14.7609986 134.172002,14.62 133.692,14.62 C133.139997,14.62 132.690002,14.7399988 132.342,14.98 C131.993998,15.2200012 131.754001,15.6099973 131.622,16.15 L129.66,15.322 C129.852001,14.5419961 130.283997,13.9300022 130.956,13.486 C131.628003,13.0419978 132.503995,12.82 133.584,12.82 C134.868006,12.82 135.869996,13.0989972 136.59,13.657 C137.310004,14.2150028 137.67,15.0399945 137.67,16.132 L137.67,19.822 C137.67,20.0620012 137.723999,20.2359995 137.832,20.344 C137.940001,20.4520005 138.107999,20.506 138.336,20.506 Z M133.116,20.506 C133.644003,20.506 134.126998,20.3770013 134.565,20.119 C135.003002,19.8609987 135.222,19.5100022 135.222,19.066 L135.222,18.13 L133.296,18.562 C132.887998,18.6580005 132.585001,18.7869992 132.387,18.949 C132.188999,19.1110008 132.09,19.3359986 132.09,19.624 C132.09,19.9120014 132.179999,20.1309992 132.36,20.281 C132.540001,20.4310007 132.791998,20.506 133.116,20.506 Z M145.734,12.82 C146.934006,12.82 147.875997,13.2339959 148.56,14.062 C149.244003,14.8900041 149.586,16.0419926 149.586,17.518 C149.586,18.9820073 149.244003,20.1249959 148.56,20.947 C147.875997,21.7690041 146.934006,22.18 145.734,22.18 C145.025996,22.18 144.411003,22.0030018 143.889,21.649 C143.366997,21.2949982 142.974001,20.818003 142.71,20.218 L142.62,22 L140.442,22 L140.442,9.058 L142.908,9.058 L142.908,14.476 C143.184001,13.9599974 143.561998,13.5550015 144.042,13.261 C144.522002,12.9669985 145.085997,12.82 145.734,12.82 Z M144.996,20.29 C145.668003,20.29 146.189998,20.0500024 146.562,19.57 C146.934002,19.0899976 147.12,18.4000045 147.12,17.5 C147.12,16.5999955 146.934002,15.9100024 146.562,15.43 C146.189998,14.9499976 145.668003,14.71 144.996,14.71 C144.395997,14.71 143.910002,14.9199979 143.538,15.34 C143.165998,15.7600021 142.956,16.3479962 142.908,17.104 L142.908,17.896 C142.956,18.6640038 143.165998,19.2549979 143.538,19.669 C143.910002,20.0830021 144.395997,20.29 144.996,20.29 Z M157.056,12.82 C158.256006,12.82 159.197997,13.2339959 159.882,14.062 C160.566003,14.8900041 160.908,16.0419926 160.908,17.518 C160.908,18.9820073 160.566003,20.1249959 159.882,20.947 C159.197997,21.7690041 158.256006,22.18 157.056,22.18 C156.347996,22.18 155.733003,22.0030018 155.211,21.649 C154.688997,21.2949982 154.296001,20.818003 154.032,20.218 L153.942,22 L151.764,22 L151.764,9.058 L154.23,9.058 L154.23,14.476 C154.506001,13.9599974 154.883998,13.5550015 155.364,13.261 C155.844002,12.9669985 156.407997,12.82 157.056,12.82 Z M156.318,20.29 C156.990003,20.29 157.511998,20.0500024 157.884,19.57 C158.256002,19.0899976 158.442,18.4000045 158.442,17.5 C158.442,16.5999955 158.256002,15.9100024 157.884,15.43 C157.511998,14.9499976 156.990003,14.71 156.318,14.71 C155.717997,14.71 155.232002,14.9199979 154.86,15.34 C154.487998,15.7600021 154.278,16.3479962 154.23,17.104 L154.23,17.896 C154.278,18.6640038 154.487998,19.2549979 154.86,19.669 C155.232002,20.0830021 155.717997,20.29 156.318,20.29 Z M164.328,11.704 C163.307995,11.704 162.798,11.2660044 162.798,10.39 C162.798,9.50199556 163.307995,9.058 164.328,9.058 C165.348005,9.058 165.858,9.50199556 165.858,10.39 C165.858,11.2660044 165.348005,11.704 164.328,11.704 Z M165.552,22 L163.086,22 L163.086,13 L165.552,13 L165.552,22 Z M174.336,21.442 C174.047999,21.6700011 173.685002,21.8499993 173.247,21.982 C172.808998,22.1140007 172.350002,22.18 171.87,22.18 C169.86599,22.18 168.864,21.2740091 168.864,19.462 L168.864,14.836 L167.226,14.836 L167.226,13 L168.864,13 L168.864,10.93 L171.33,10.246 L171.33,13 L174.246,13 L174.246,14.836 L171.33,14.836 L171.33,19.066 C171.33,19.8940041 171.743996,20.308 172.572,20.308 C173.100003,20.308 173.561998,20.1400017 173.958,19.804 L174.336,21.442 Z" id="VowpalWabbit" fill="#333333" fill-rule="nonzero"></path>
                <g id="logo_vw_color" transform="translate(3.000000, 0.000000)" fill="#2A3B93">
                    <path d="M27.9875518,16.6117194 C27.9875518,9.21947752 21.9666728,9.36035971 21.9666728,9.36035971 C21.3736977,6.15536974 20.3362508,3.5963294 19.3414955,1.96947553 C18.1790857,0.436543115 17.3241355,0 17.3241355,0 C16.2887633,0.700737156 15.7766231,3.93943024 15.7766231,3.93943024 C14.1726939,1.18184505 12.329851,1.05294263 12.329851,1.05294263 C9.93824094,8.37466357 17.0427696,11.1203489 17.0427696,11.1203489 C9.97542657,11.1203489 6.33307087,15.0400524 4.59284756,17.9877167 C4.0042614,19.0524794 3.60319929,20.0302689 3.35048069,20.7371557 L2.99801525,21.8605394 C1.89952322,21.2108361 0.011355398,21.1878349 0.011355398,21.1878349 C-0.278708419,29.2136474 5.0845596,28.0167877 5.0845596,28.0167877 C5.0845596,29.1432063 6.56177043,30 6.56177043,30 L18.0978518,30 C18.0978518,30 17.9248509,28.5478912 16.7183131,27.7616983 C16.5196972,27.4693917 16.4533057,27.212705 16.6897456,26.9422016 C17.354698,26.1816454 17.8296525,27.1798804 17.8296525,27.1798804 L18.3302221,27.8553801 C19.7539686,29.627988 20.7440159,29.9516816 21.1646284,30 L21.391732,30 C20.5763614,27.5009384 20.6054875,25.3190215 20.6054875,25.3190215 C20.4822802,22.1365535 22.8107704,19.2166024 22.8107704,19.2166024 C28.5084697,19.2166024 27.9875518,16.6117194 27.9875518,16.6117194" id="logo_rabbit"></path>
                </g>
            </g>
        </g>
    </g>
</svg>
      </a>
    </div>
  </div>
</div>

<div class="mobile_nav">
  <button type="button" class="go_back_button">
    <
  </button>

  <a href="https://vowpalwabbit.org/start.html">
    Get started
  </a>
  <a href="https://vowpalwabbit.org/features.html">
    Features
  </a>
  <a href="https://vowpalwabbit.org/tutorials.html">
    Tutorials
  </a>
  <a href="https://vowpalwabbit.org/blog.html">
    Blog
  </a>
  <a href="https://vowpalwabbit.org/research.html">
    Research
  </a>
  <div class="external_links">
    <a href="https://github.com/VowpalWabbit/vowpalwabbit.github.io/issues/new"
      target="_blank"
    >
      Feedback
    </a>

    <a class="active" href="index.html">
      Docs
    </a>

    <a href="https://github.com/VowpalWabbit/vowpal_wabbit/wiki" target="_blank">
      Wiki
    </a>

    <a href="https://github.com/VowpalWabbit/vowpal_wabbit" target="_blank" class="github_link">
      <?xml version="1.0" encoding="UTF-8"?>
<svg width="30px" height="30px" viewBox="0 0 30 30" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 53 (72520) - https://sketchapp.com -->
    <title>GitHub</title>
    <desc>Created with Sketch.</desc>
    <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="HD_Desktop_header_Home" transform="translate(-1538.000000, -58.000000)" fill="#FFFFFF">
            <g id="Header">
                <path d="M1568,73.7951128 C1567.94603,74.2583723 1567.89891,74.7224863 1567.83682,75.1847206 C1567.56271,77.2238487 1566.86543,79.1138828 1565.7732,80.8526868 C1564.55268,82.7956941 1562.9969,84.4188114 1561.05088,85.6538569 C1560.03339,86.2996179 1558.94817,86.8066231 1557.80753,87.1895684 C1557.17559,87.4016322 1556.73848,87.0743943 1556.73531,86.4093237 C1556.72907,85.1020808 1556.73745,83.7947524 1556.73164,82.487424 C1556.72804,81.6908602 1556.64825,80.9063436 1556.21259,80.2087201 C1556.0855,80.0052003 1555.92463,79.8226135 1555.77393,79.6234512 C1556.35935,79.5140871 1556.9463,79.4362506 1557.51632,79.2916849 C1559.04696,78.9034423 1560.41543,78.2275208 1561.34791,76.8924242 C1562.03287,75.9115647 1562.34632,74.7851144 1562.48436,73.6108172 C1562.59169,72.6982249 1562.62222,71.7826422 1562.42971,70.8740656 C1562.23608,69.9599354 1561.84044,69.1418405 1561.22834,68.4359293 C1561.07756,68.2620575 1561.04763,68.1215929 1561.12221,67.896713 C1561.52468,66.6818314 1561.3562,65.491984 1560.9042,64.3262309 C1560.87829,64.2595017 1560.76574,64.1973008 1560.68569,64.1853391 C1560.15364,64.1058793 1559.65196,64.2559986 1559.18533,64.4761793 C1558.42904,64.8332361 1557.69764,65.242668 1556.9487,65.6159585 C1556.82229,65.6790137 1556.64782,65.7219904 1556.51706,65.6889249 C1554.16941,65.0964789 1551.82595,65.097077 1549.47805,65.6883268 C1549.34078,65.7228448 1549.14638,65.677134 1549.02331,65.5987849 C1548.07109,64.9919849 1547.06446,64.5120644 1545.97001,64.2236166 C1545.9511,64.218661 1545.93272,64.2115694 1545.91364,64.2077246 C1545.22551,64.0670892 1545.09971,64.1456947 1544.9036,64.8108506 C1544.58682,65.884755 1544.5296,66.9550708 1544.90668,68.0296587 C1544.93627,68.1139033 1544.90129,68.2616303 1544.8404,68.3306664 C1543.60397,69.7341156 1543.31096,71.3989279 1543.46559,73.1936101 C1543.55933,74.2817831 1543.81162,75.3262104 1544.29869,76.3083514 C1544.97176,77.6654063 1546.11181,78.4952066 1547.4926,78.982475 C1548.35956,79.2884382 1549.27852,79.4473579 1550.18824,79.6758264 C1550.19526,79.6319098 1550.20056,79.6666842 1550.18568,79.6820635 C1549.71726,80.1697591 1549.45556,80.755028 1549.34531,81.4170227 C1549.33137,81.5007546 1549.27365,81.6203716 1549.20685,81.6454912 C1548.16482,82.0372369 1547.11706,82.2433199 1546.08683,81.6149888 C1545.61867,81.3295314 1545.27683,80.9169382 1545.00101,80.4479541 C1544.56852,79.712395 1543.95864,79.179074 1543.13923,78.9361661 C1542.84434,78.8487602 1542.50823,78.8709748 1542.19359,78.8892591 C1541.97909,78.9018189 1541.90862,79.062362 1542.05256,79.2422147 C1542.18529,79.4077988 1542.32025,79.5950849 1542.4978,79.6971865 C1543.28625,80.1507913 1543.72798,80.8753286 1544.08881,81.6641173 C1544.30382,82.1341266 1544.48812,82.6140471 1544.88675,82.9753759 C1545.52169,83.5510755 1546.29115,83.7682658 1547.11612,83.8044072 C1547.81434,83.834995 1548.51496,83.8107298 1549.24722,83.8107298 C1549.24611,83.8009041 1549.26073,83.8742123 1549.26167,83.9476058 C1549.27211,84.7377616 1549.2828,85.5279173 1549.28844,86.3180731 C1549.294,87.0913115 1548.82935,87.4109452 1548.0952,87.1563319 C1544.28705,85.8355039 1541.4928,83.3342269 1539.62819,79.7992882 C1538.22405,77.1372118 1537.78027,74.2780237 1538.09739,71.2935795 C1538.4294,68.1688416 1539.66702,65.4337134 1541.73193,63.0872551 C1543.89022,60.6347648 1546.57714,59.0045559 1549.78825,58.3523869 C1554.45335,57.4048494 1558.71409,58.3562318 1562.44442,61.3515269 C1565.27245,63.6222848 1567.02271,66.5767393 1567.72914,70.1361141 C1567.83314,70.6605492 1567.87265,71.197715 1567.94398,71.7286436 C1567.95792,71.832625 1567.9811,71.9354102 1568,72.0387934 L1568,73.7951128 Z" id="GitHub"></path>
            </g>
        </g>
    </g>
</svg>

      <div>
        GitHub
      </div>
    </a>
  </div>
</div>

<script script type="text/javascript">
  $(".mobile_nav_container").on("click", ".hamburger_icon", (e) => {
    e.stopPropagation();
    $(".mobile_nav").addClass("open");
  });

  $('body').on("click", ".mobile_nav .go_back_button", () => {
    $(".mobile_nav").removeClass("open");
  });
</script>


    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><a href="https://vowpalwabbit.org/docs/">
  latest
</a>

<i class="fas fa-angle-down"></i>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorials/index.html">
   Tutorials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/cmd_first_steps.html">
     Command Line Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/cmd_linear_regression.html">
     Command Line Linear Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/cmd_csv_with_iris_dataset.html">
     Command Line for CSV Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/off_policy_evaluation.html">
     Offline Policy Evaluation Using the Command Line
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/python_cats.html">
     Contextual Bandits with Continuous Actions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/python_classification.html">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/python_Contextual_bandits_and_Vowpal_Wabbit.html">
     Contextual Bandits
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/python_Simulating_a_news_personalization_scenario_using_Contextual_Bandits.html">
     Contextual Bandit Content Personalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/python_first_steps.html">
     Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/python_slates.html">
     Slates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/DFtoVW_tutorial.html">
     Pandas DataFrame to VowpalWabbit Format Conversion
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Examples
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="basics.html">
     Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="contextual_bandit.html">
     Contextual Bandits
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mini_vw.html">
     Mini VW
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="poisson_regression.html">
     Poisson Regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="predict.html">
     Predict comparison
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="search_covington.html">
     Search - Covington
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="search_sequence_ldf.html">
     Search - Sequence LDF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="search_sequence.html">
     Search - Sequence
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Search - Speech Tagger
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../reference/index.html">
   API Reference
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/vowpalwabbit.html">
     vowpalwabbit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/vowpalwabbit.dftovw.html">
     vowpalwabbit.dftovw
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/vowpalwabbit.sklearn.html">
     vowpalwabbit.sklearn
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/vowpalwabbit.pyvw.html">
     vowpalwabbit.pyvw
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/vowpalwabbit.pyvw.pylibvw.html">
     vowpalwabbit.pyvw.pylibvw
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../reference/python_8110_900_migration_guide.html">
     Python 8.11 to 9 migration
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../command_line_args.html">
   Command line options
  </a>
 </li>
</ul>

  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removing-the-auto-features">
   Removing the AUTO features
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#very-silly-covington-esqu-dependency-parsing">
   Very silly Covington-esqu dependency parsing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ldf-based-covington-style-dependency-parser">
   LDF-based Covington-style dependency parser
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-simple-word-alignment-model">
   A simple word-alignment model
  </a>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      

<div class="tocsection editthispage">
    <a href="https://github.com/VowpalWabbit/vowpal_wabbit/edit/master/python/docs/source/examples/search_speech_tagger.ipynb">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
    
    
    <button title="Activate interactive cells" class="thebelab-button thebe-launch-button" onclick="initThebe()">
        Make live
    </button>
    <a class="binder-button" href="https://mybinder.org/v2/gh/VowpalWabbit/vowpal_wabbit/master?filepath=python/docs/source/examples/search_speech_tagger.ipynb">
        <img class="binder-button-logo" src="https://mybinder.org/badge_logo.svg" alt="Binder">
    </a>
    

              <article class="bd-article" role="main">
                
  <section id="search-speech-tagger">
<h1>Search - Speech Tagger<a class="headerlink" href="#search-speech-tagger" title="Permalink to this heading">#</a></h1>
<p>This tutorial walks you through writing learning to search code using the VW python interface. Once you’ve completed this, you can graduate to the C++ version, which will be faster for the computer but more painful for you.</p>
<p>The “learning to search” paradigm solves problems that look like the following. You have a sequence of decisions to make. At the end of making these decisions, the world tells you how bad your decisions were. You want to condition later decisions on earlier decisions. But thankfully, at “training time,” you have access to an <em>oracle</em> that will tell you the right answer.</p>
<p>Let’s start with a simple example: sequence labeling for Part of Speech tagging. The goal is to take a sequence of words (“the monster ate a big sandwich”) and label them with their parts of speech (in this case: Det Noun Verb Det Adj Noun).</p>
<p>We will choose to solve this problem with left-to-right search. I.e., we’ll label the first word, then the second then the third and so on.</p>
<p>For any vw project in python, we have to start by importing the pyvw library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vowpalwabbit</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s define our data first. We’ll do this first by defining the labels (one annoying thing is that labels in vw have to be integers):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DET</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">NOUN</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">VERB</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">ADJ</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">my_dataset</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="n">DET</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">NOUN</span><span class="p">,</span> <span class="s2">&quot;monster&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">VERB</span><span class="p">,</span> <span class="s2">&quot;ate&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">DET</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ADJ</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">NOUN</span><span class="p">,</span> <span class="s2">&quot;sandwich&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="p">[(</span><span class="n">DET</span><span class="p">,</span> <span class="s2">&quot;the&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">NOUN</span><span class="p">,</span> <span class="s2">&quot;sandwich&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">VERB</span><span class="p">,</span> <span class="s2">&quot;was&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">ADJ</span><span class="p">,</span> <span class="s2">&quot;tasty&quot;</span><span class="p">)],</span>
    <span class="p">[(</span><span class="n">NOUN</span><span class="p">,</span> <span class="s2">&quot;it&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">VERB</span><span class="p">,</span> <span class="s2">&quot;ate&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">NOUN</span><span class="p">,</span> <span class="s2">&quot;it&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">ADJ</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">)],</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_dataset</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(2, &#39;it&#39;), (3, &#39;ate&#39;), (2, &#39;it&#39;), (4, &#39;all&#39;)]
</pre></div>
</div>
</div>
</div>
<p>Here we have an example of a (correctly) tagged sentence.</p>
<p>Now, we need to write the structured prediction code. To do this, we have to write a new class that derives from the <code class="docutils literal notranslate"><span class="pre">pyvw.SearchTask</span></code> class.</p>
<p>This class <em>must</em> have two functions: <code class="docutils literal notranslate"><span class="pre">__init__</span></code> and <code class="docutils literal notranslate"><span class="pre">_run</span></code>.</p>
<p>The initialization function takes three arguments (plus <code class="docutils literal notranslate"><span class="pre">self</span></code>): a vw object (<code class="docutils literal notranslate"><span class="pre">vw</span></code>), a search object (<code class="docutils literal notranslate"><span class="pre">sch</span></code>), and the number of actions (<code class="docutils literal notranslate"><span class="pre">num_actions</span></code>) that this object has been initialized with. Within the initialization function, we must first initialize the parent class, and then we can set whatever options we want via <code class="docutils literal notranslate"><span class="pre">sch.set_options(...)</span></code>. Of course we can also do whatever additional initialization we like.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_run</span></code> function executes the sequence of decisions on a given input. The input will be of whatever type our data is (so, in the above example, it will be a list of (label,word) pairs).</p>
<p>Here is a basic implementation of sequence labeling:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SequenceLabeler</span><span class="p">(</span><span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">):</span>
        <span class="c1"># you must must must initialize the parent class</span>
        <span class="c1"># this will automatically store self.sch &lt;- sch, self.vw &lt;- vw</span>
        <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">)</span>

        <span class="c1"># set whatever options you want</span>
        <span class="n">sch</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">sch</span><span class="o">.</span><span class="n">AUTO_HAMMING_LOSS</span> <span class="o">|</span> <span class="n">sch</span><span class="o">.</span><span class="n">AUTO_CONDITION_FEATURES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span>
    <span class="p">):</span>  <span class="c1"># it&#39;s called _run to remind you that you shouldn&#39;t call it directly!</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)):</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="c1"># use &quot;with...as...&quot; to guarantee that the example is finished properly</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">example</span><span class="p">({</span><span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">word</span><span class="p">]})</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sch</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                <span class="n">examples</span><span class="o">=</span><span class="n">ex</span><span class="p">,</span>
                <span class="n">my_tag</span><span class="o">=</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">oracle</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
                <span class="n">condition</span><span class="o">=</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">)],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">finish_example</span><span class="p">(</span>
                <span class="p">[</span><span class="n">ex</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># must pass the example in as a list because search is a MultiEx reduction</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s unpack this a bit.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function is simple. It first calls the parent initializer and then sets some options. The options it sets are two things designed to make the programmer’s life easier. The first is <code class="docutils literal notranslate"><span class="pre">AUTO_HAMMING_LOSS</span></code>. Remember earlier we said that when the sequence of decision is made, you have to say how bad it was? This says that we want this to be computed automatically by comparing the individual decisions to the oracle decisions, and defining the loss to be the sum of incorrect decisions.</p>
<p>The second is <code class="docutils literal notranslate"><span class="pre">AUTO_CONDITION_FEATURES</span></code>. This is a bit subtler. Later in the <code class="docutils literal notranslate"><span class="pre">_run</span></code> function, we will say that the label of the <code class="docutils literal notranslate"><span class="pre">n</span></code>th word depends on the label of the <code class="docutils literal notranslate"><span class="pre">n-1</span></code>th word. In order to get the underlying classifier to <em>pay attention</em> to that conditioning, we need to add features. We could do that manually (we’ll do this later) or we can ask vw to do it automatically for us. For simplicity, we choose the latter.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_run</span></code> function takes a sentence (list of pos/word pairs) as input. We loop over each word position <code class="docutils literal notranslate"><span class="pre">n</span></code> in the sentence and extract the <code class="docutils literal notranslate"><span class="pre">pos,word</span></code> pair. We then construct a VW example that consists of a single feature (the <code class="docutils literal notranslate"><span class="pre">word</span></code>) in the ‘w’ namespace. Given that example <code class="docutils literal notranslate"><span class="pre">ex</span></code>, we make a search-based prediction by calling <code class="docutils literal notranslate"><span class="pre">self.sch.predict(...)</span></code>. This is a fairly complicated function that takes a number of arguments. Here, we are calling it with the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">examples=ex</span></code>: This tells the predictor what features to use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">my_tag=n+1</span></code>: In general, we want to condition the prediction of the <code class="docutils literal notranslate"><span class="pre">n</span></code>th label on the <code class="docutils literal notranslate"><span class="pre">n-1</span></code>th label. In order to do this, we have to give each prediction a “name” so that we can refer back to it in the future. This name needs to be an integer <code class="docutils literal notranslate"><span class="pre">&gt;=</span> <span class="pre">1</span></code>. So we’ll call the first word <code class="docutils literal notranslate"><span class="pre">1</span></code>, the second word <code class="docutils literal notranslate"><span class="pre">2</span></code>, and so on. It has to be <code class="docutils literal notranslate"><span class="pre">n+1</span></code> and not <code class="docutils literal notranslate"><span class="pre">n</span></code> because of the 1-based requirement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oracle=pos</span></code>: As mentioned before, on training data, we need to tell the system what the “true” (or “best”) decision is at this point in time. Here, it is the given part of speech label.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">condition=(n,'p')</span></code>: This says that this prediction depends on the output of whichever-prediction-was-called-<code class="docutils literal notranslate"><span class="pre">n</span></code>, and that the “nature” of that condition is called ‘p’ (for “predecessor” in this case, though this is entirely up to you)</p></li>
</ul>
<p>Now, we’re ready to train the model. We do this in three steps. First, we initialize a vw object, telling it that we have a <code class="docutils literal notranslate"><span class="pre">--search</span></code> task with 4 labels, second that the specific type of <code class="docutils literal notranslate"><span class="pre">--search_task</span></code> is <code class="docutils literal notranslate"><span class="pre">hook</span></code> (you will always use the <code class="docutils literal notranslate"><span class="pre">hook</span></code> task) and finally that we want it to be quiet and use a larger <code class="docutils literal notranslate"><span class="pre">ring_size</span></code> (you can ignore the <code class="docutils literal notranslate"><span class="pre">ring_size</span></code> for now).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vw</span> <span class="o">=</span> <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">Workspace</span><span class="p">(</span><span class="s2">&quot;--search 4 --search_task hook&quot;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we need to initialize the search task. We use the <code class="docutils literal notranslate"><span class="pre">vw.init_search_task</span></code> function to do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sequenceLabeler</span> <span class="o">=</span> <span class="n">vw</span><span class="o">.</span><span class="n">init_search_task</span><span class="p">(</span><span class="n">SequenceLabeler</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, we can train on the dataset we defined earlier, using <code class="docutils literal notranslate"><span class="pre">sequenceLabeler.learn</span></code> (the <code class="docutils literal notranslate"><span class="pre">.learn</span></code> function is inherited from the <code class="docutils literal notranslate"><span class="pre">pyvw.SearchTask</span></code> class). The <code class="docutils literal notranslate"><span class="pre">.learn</span></code> function takes any iterator over data. Whatever type of data it iterates over is what it will feed to your <code class="docutils literal notranslate"><span class="pre">_run</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">sequenceLabeler</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">my_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Of course, we want to see if it’s learned anything. So let’s create a single test example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_example</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="s2">&quot;the sandwich ate a monster&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_example</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(1, &#39;the&#39;), (1, &#39;sandwich&#39;), (1, &#39;ate&#39;), (1, &#39;a&#39;), (1, &#39;monster&#39;)]
</pre></div>
</div>
</div>
</div>
<p>We’ve used <code class="docutils literal notranslate"><span class="pre">0</span></code> as the labels so you can be sure that vw isn’t cheating and it’s actually making predictions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">sequenceLabeler</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_example</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3, 1, 2]
</pre></div>
</div>
</div>
</div>
<p>If we look back at our POS tag definitions, this is DET NOUN VERB DET NOUN, which is indeed correct!</p>
<section id="removing-the-auto-features">
<h2>Removing the AUTO features<a class="headerlink" href="#removing-the-auto-features" title="Permalink to this heading">#</a></h2>
<p>In the above example we used both AUTO_HAMMING_LOSS and AUTO_CONDITION_FEATURES. To make more explicit what these are doing, let’s rewrite our <code class="docutils literal notranslate"><span class="pre">SequenceLabeler</span></code> class without them! Here’s a version that gets rid of both simultaneously. It is only modestly more complex:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SequenceLabeler2</span><span class="p">(</span><span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">):</span>
        <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)):</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">prevPred</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&lt;s&gt;&quot;</span>

            <span class="n">ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">example</span><span class="p">({</span><span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">word</span><span class="p">],</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">prevPred</span><span class="p">]})</span>

            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sch</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                <span class="n">examples</span><span class="o">=</span><span class="n">ex</span><span class="p">,</span> <span class="n">my_tag</span><span class="o">=</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">oracle</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">vw</span><span class="o">.</span><span class="n">finish_example</span><span class="p">([</span><span class="n">ex</span><span class="p">])</span>

            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">pred</span> <span class="o">!=</span> <span class="n">pos</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">+=</span> <span class="mf">1.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sch</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>


<span class="n">sequenceLabeler2</span> <span class="o">=</span> <span class="n">vw</span><span class="o">.</span><span class="n">init_search_task</span><span class="p">(</span><span class="n">SequenceLabeler2</span><span class="p">)</span>
<span class="n">sequenceLabeler2</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">my_dataset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sequenceLabeler2</span><span class="o">.</span><span class="n">predict</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="s2">&quot;the sandwich ate a monster&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3, 1, 2]
</pre></div>
</div>
</div>
</div>
<p>If executed correctly, this should have printed <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">1,</span> <span class="pre">2]</span></code>.</p>
<p>There are essentially two things that changed here. In order to get rid of AUTO_HAMMING_LOSS, we had to keep track of how many errors the predictor had made. This is done by checking whether <code class="docutils literal notranslate"><span class="pre">pred</span> <span class="pre">!=</span> <span class="pre">pos</span></code> inside the inner loop, and then at the end calling <code class="docutils literal notranslate"><span class="pre">self.sch.loss(loss)</span></code> to tell the search procedure how well we did.</p>
<p>In order to get rid of AUTO_CONDITION_FEATURES, we need to explicitly add the previous prediction as features to the example we are predicting with. Here, we’ve done this by extracting the previous prediction (<code class="docutils literal notranslate"><span class="pre">prevPred</span></code>) and explicitly adding it as a feature (in the ‘p’ namespace) during the example construction.</p>
<p><strong>Important Note:</strong> even though we’re not using AUTO_CONDITION_FEATURES, we <em>still</em> must tell the search process that this prediction depends on the previous prediction. We need to do this because the learning algorithm automatically memoizes certain computations, and so it needs to know that, when memoizing, to remember that this prediction <em>might have been different</em> if a previous decision were different.</p>
</section>
<section id="very-silly-covington-esqu-dependency-parsing">
<h2>Very silly Covington-esqu dependency parsing<a class="headerlink" href="#very-silly-covington-esqu-dependency-parsing" title="Permalink to this heading">#</a></h2>
<p>Let’s also try a variant of dependency parsing to see that this doesn’t work just for sequence-labeling list tasks. First we need to define some data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the label for each word is its parent, or -1 for root</span>
<span class="n">my_dataset</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># 0</span>
        <span class="p">(</span><span class="s2">&quot;monster&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># 1</span>
        <span class="p">(</span><span class="s2">&quot;ate&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># 2</span>
        <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="c1"># 3</span>
        <span class="p">(</span><span class="s2">&quot;big&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="c1"># 4</span>
        <span class="p">(</span><span class="s2">&quot;sandwich&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">],</span>  <span class="c1"># 5</span>
    <span class="p">[(</span><span class="s2">&quot;the&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sandwich&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tasty&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>  <span class="c1"># 0  # 1  # 2  # 3</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># 0</span>
        <span class="p">(</span><span class="s2">&quot;sandwich&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># 1</span>
        <span class="p">(</span><span class="s2">&quot;ate&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># 2</span>
        <span class="p">(</span><span class="s2">&quot;itself&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># 3</span>
    <span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>For instance, in the first sentence, the parent of “the” is “monster”; the parent of “monster” is “ate”; and “ate” is the root.</p>
<p>The basic idea of a Covington-style dependency parser is to loop over all O(N^2) word pairs and ask if one is the parent of the other. In a real parser you would want to make sure that you don’t have cycles, that you have a unique root and (perhaps) that the resulting graph is projective. I’m not doing that here. Hopefully I’ll add a shift-reduce parser example later that <em>does</em> do this. Here’s an implementation of this idea:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CovingtonDepParser</span><span class="p">(</span><span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">):</span>
        <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">)</span>
        <span class="n">sch</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">sch</span><span class="o">.</span><span class="n">AUTO_HAMMING_LOSS</span> <span class="o">|</span> <span class="n">sch</span><span class="o">.</span><span class="n">AUTO_CONDITION_FEATURES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="c1"># initialize our output so everything is a root</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">wordN</span><span class="p">,</span> <span class="n">parN</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">wordM</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;*root*&quot;</span>
                <span class="c1"># ask the question: is m the parent of n?</span>
                <span class="n">isParent</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="n">parN</span> <span class="k">else</span> <span class="mi">1</span>

                <span class="c1"># construct an example</span>
                <span class="nb">dir</span> <span class="o">=</span> <span class="s2">&quot;l&quot;</span> <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">else</span> <span class="s2">&quot;r&quot;</span>
                <span class="n">ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">example</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">wordN</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordN</span><span class="p">],</span>
                        <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">wordM</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordN</span><span class="p">],</span>
                        <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">wordN</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordM</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordN</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordM</span><span class="p">],</span>
                        <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
                        <span class="p">]</span>
                        <span class="o">+</span> <span class="p">[</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
                        <span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sch</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                    <span class="n">examples</span><span class="o">=</span><span class="n">ex</span><span class="p">,</span>
                    <span class="n">my_tag</span><span class="o">=</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">oracle</span><span class="o">=</span><span class="n">isParent</span><span class="p">,</span>
                    <span class="n">condition</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">+</span> <span class="n">n</span><span class="p">),</span> <span class="s2">&quot;q&quot;</span><span class="p">),</span>
                    <span class="p">],</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">finish_example</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">ex</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># must pass the example in as a list because search is a MultiEx reduction</span>
                <span class="k">if</span> <span class="n">pred</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">output</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<p>In this, <code class="docutils literal notranslate"><span class="pre">output</span></code> stores the predicted tree and is initialized with every word being a root. We then loop over every word (<code class="docutils literal notranslate"><span class="pre">n</span></code>) and every possible parent (<code class="docutils literal notranslate"><span class="pre">m</span></code>, which can be -1, though that’s really kind of unnecessary).</p>
<p>The features are basically the words under consideration, the words paired with the direction of the edge, the pair of words, and then a bunch of (binned) distance features.</p>
<p>We can train and run this parser with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vw</span> <span class="o">=</span> <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">Workspace</span><span class="p">(</span><span class="s2">&quot;--search 2 --search_task hook&quot;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">vw</span><span class="o">.</span><span class="n">init_search_task</span><span class="p">(</span><span class="n">CovingtonDepParser</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>  <span class="c1"># do ten passes over the training data</span>
    <span class="n">task</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">my_dataset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;testing&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">predict</span><span class="p">([(</span><span class="n">w</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="s2">&quot;the monster ate a sandwich&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;should have printed [ 1 2 -1 4 2 ]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>testing
[1, 2, -1, 4, 2]
should have printed [ 1 2 -1 4 2 ]
</pre></div>
</div>
</div>
</div>
<p>One could argue that a more natural way to do this would be with LDF rather than the inner loop over <code class="docutils literal notranslate"><span class="pre">m</span></code>. We’ll do that next.</p>
</section>
<section id="ldf-based-covington-style-dependency-parser">
<h2>LDF-based Covington-style dependency parser<a class="headerlink" href="#ldf-based-covington-style-dependency-parser" title="Permalink to this heading">#</a></h2>
<p>One of the weirdnesses in the previous parser implementation is that it makes N-many binary decisions per word (“is word n my parent?”) rather than a single N-way decision. The latter makes more sense.</p>
<p>The challenge is that you cannot set this up as a vanilla multiclass classification problem because (a) the number of “classes” is a function of the input (a length N sentence will have N classes) and (b) class “1” and “2” don’t mean anything consistently across examples.</p>
<p>The way around this is label-dependent features (LDF). In LDF mode, the class ids are (essentially – see caveat below) irrelevant. Instead, you simply provide features that depend on the label (hence “LDF”). In particular, for each possible label, you provide a <em>different</em> feature vector, and the goal of learning is to pick one of those as the “correct” one.</p>
<p>Here’s a re-implementation of Covington using LDF:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CovingtonDepParserLDF</span><span class="p">(</span><span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">):</span>
        <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">)</span>
        <span class="n">sch</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span>
            <span class="n">sch</span><span class="o">.</span><span class="n">AUTO_HAMMING_LOSS</span> <span class="o">|</span> <span class="n">sch</span><span class="o">.</span><span class="n">IS_LDF</span> <span class="o">|</span> <span class="n">sch</span><span class="o">.</span><span class="n">AUTO_CONDITION_FEATURES</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">makeExample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="n">wordN</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">wordM</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;*ROOT*&quot;</span>
        <span class="nb">dir</span> <span class="o">=</span> <span class="s2">&quot;l&quot;</span> <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">else</span> <span class="s2">&quot;r&quot;</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">example</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">wordN</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordN</span><span class="p">],</span>
                <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">wordM</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordM</span><span class="p">],</span>
                <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">wordN</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordM</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordN</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">wordM</span><span class="p">],</span>
                <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
                <span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="n">labelType</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">lCostSensitive</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ex</span><span class="o">.</span><span class="n">set_label_string</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:0&quot;</span>
        <span class="p">)</span>  <span class="c1"># project the m-indices (-1...N into 1...N+2)</span>
        <span class="k">return</span> <span class="n">ex</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
        <span class="c1"># initialize our output so everything is a root</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="c1"># make LDF examples</span>
            <span class="n">examples</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">makeExample</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">m</span>
            <span class="p">]</span>

            <span class="c1"># truth</span>
            <span class="n">parN</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">oracle</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parN</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">parN</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">else</span> <span class="n">parN</span>
            <span class="p">)</span>  <span class="c1"># have to -1 because we excluded n==m from list</span>

            <span class="c1"># make a prediction</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sch</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                <span class="n">examples</span><span class="o">=</span><span class="n">examples</span><span class="p">,</span>
                <span class="n">my_tag</span><span class="o">=</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">oracle</span><span class="o">=</span><span class="n">oracle</span><span class="p">,</span>
                <span class="n">condition</span><span class="o">=</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">)],</span>
            <span class="p">)</span>

            <span class="n">output</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pred</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">pred</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="k">else</span> <span class="n">pred</span>
            <span class="p">)</span>  <span class="c1"># have to +1 because n==m excluded</span>

            <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
                <span class="n">ex</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>  <span class="c1"># clean up</span>

        <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<p>There are a few things going on here. Let’s focus first on the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function. The only difference here is that when we call <code class="docutils literal notranslate"><span class="pre">sch.set_options</span></code> we provide <code class="docutils literal notranslate"><span class="pre">sch.IS_LDF</span></code> to declare that this is an LDF task.</p>
<p>Let’s skip the <code class="docutils literal notranslate"><span class="pre">makeExample</span></code> function for a minute and look at the <code class="docutils literal notranslate"><span class="pre">_run</span></code> function. You should recognize most of this from the non-LDF version. We initialize the <code class="docutils literal notranslate"><span class="pre">output</span></code> (parent) of every word to <code class="docutils literal notranslate"><span class="pre">-1</span></code> (meaning that every word is connected to the root).</p>
<p>For each word <code class="docutils literal notranslate"><span class="pre">n</span></code>, we construct <code class="docutils literal notranslate"><span class="pre">N</span></code>-many examples: one for every -1..(N-1), except for the current word <code class="docutils literal notranslate"><span class="pre">n</span></code> because you cannot have self-loops. If we were being more clever, we would only do the ones that won’t result in the creation of a cycle, but we’re not being clever.</p>
<p>Now, because the “labels” are just examples, it’s a bit more complicated to specify the oracle. The oracle is an <em>index</em> into the examples list. So if <code class="docutils literal notranslate"><span class="pre">oracle</span></code> is the oracle action, then <code class="docutils literal notranslate"><span class="pre">examples[oracle]</span></code> is the corresponding example. We compute the oracle as follows. <code class="docutils literal notranslate"><span class="pre">parN</span></code> is the <em>actual</em> parent, which is going to be something in the range <code class="docutils literal notranslate"><span class="pre">-1</span> <span class="pre">..</span> <span class="pre">(N-1)</span></code>. If <code class="docutils literal notranslate"><span class="pre">parN</span> <span class="pre">&lt;</span> <span class="pre">n</span></code> (this is a left arrow), then the oracle index is <code class="docutils literal notranslate"><span class="pre">parN+1</span></code> because the root (<code class="docutils literal notranslate"><span class="pre">-1</span></code>) is index <code class="docutils literal notranslate"><span class="pre">0</span></code> and so on. If <code class="docutils literal notranslate"><span class="pre">parN</span> <span class="pre">&gt;</span> <span class="pre">n</span></code> (note: it cannot be equal to <code class="docutils literal notranslate"><span class="pre">n</span></code>) then, beacuse <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">m</span></code> is left out of the examples list, the correct index is just <code class="docutils literal notranslate"><span class="pre">parN</span></code>. Phew.</p>
<p>We then ask for a prediction. Now, instead of giving a single example, with give the list of examples. The tag works the same way, as does the conditioning.</p>
<p>Once we get a prediction out (called <code class="docutils literal notranslate"><span class="pre">pred</span></code>) we need to figure out what parent it actually corresponds to. This is simply un-doing the computaiton two paragraphs ago!</p>
<p>Finally – and this is skippable if you trust the Python garbage collector – we tell VW that we’re done with all the examples we created. We do this just to be pedantic; it’s optional.</p>
<p>Okay, now let’s go back to the <code class="docutils literal notranslate"><span class="pre">makeExample</span></code> function. This takes two word ids (<code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">m</span></code>) and makes an example that roughly says “what would it look like if I had an edge from <code class="docutils literal notranslate"><span class="pre">n</span></code> to <code class="docutils literal notranslate"><span class="pre">m</span></code>?” We construct basically the same feautres as before. There are two major changes, though:</p>
<ol class="arabic simple">
<li><p>When we run <code class="docutils literal notranslate"><span class="pre">self.vw.example(...)</span></code> we provide <code class="docutils literal notranslate"><span class="pre">labelType=self.vw.lCostSensitive</span></code> as an argument. This is because under the hood, vw treats LDF examples as cost-sensitive classification examples. This means they need to have cost-sensitive labels, so that’s how we need to create them.</p></li>
<li><p>We explicitly set the label of the this example to <code class="docutils literal notranslate"><span class="pre">str(m+2)+&quot;:0&quot;</span></code>. What is this? Well, this is <em>optional</em> but recommended. Here’s the issue. In LDF mode, recall that labels have no intrinsic meaning. This means that when vw does auto-conditioning, it’s not really clear what to use as the “previous prediction.” By giving explicit label names (in this case, m+2) we’re recording what the position of the last parent, which may be useful for predicting the next parent. We could avoid this necessity if we did our own feature engineering on the history, but for now, this seems to capture the right intuition.</p></li>
</ol>
<p>Given all this, we can now train and test our parser:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vw</span> <span class="o">=</span> <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">Workspace</span><span class="p">(</span><span class="s2">&quot;--search 0 --csoaa_ldf m --search_task hook&quot;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">vw</span><span class="o">.</span><span class="n">init_search_task</span><span class="p">(</span><span class="n">CovingtonDepParserLDF</span><span class="p">)</span>
<span class="c1"># BUG: This currently does not work because oracle generation is incorrect (generates invalid oracle values)#for p in range(2): # do two passes over the training data</span>
<span class="c1">#    task.learn(my_dataset)</span>
<span class="c1"># print(task.predict( [(w,-1) for w in &quot;the monster ate a sandwich&quot;.split()] ))</span>
</pre></div>
</div>
</div>
</div>
<p>The correct parse of this sentence is <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">-1,</span> <span class="pre">4,</span> <span class="pre">2]</span></code> which is what this should have printed.</p>
<p>There are two major things to notice in the initialization of VW. The first is that we say <code class="docutils literal notranslate"><span class="pre">--search</span> <span class="pre">0</span></code>. The zero labels argument to <code class="docutils literal notranslate"><span class="pre">--search</span></code> declares that this is going to be an LDF task. We also have to tell VW that we want an LDF-enabled cost-sensitive learner, which is what <code class="docutils literal notranslate"><span class="pre">--csoaa_ldf</span> <span class="pre">m</span></code> does (if you’re wondering, <code class="docutils literal notranslate"><span class="pre">m</span></code> means “multiline” – just treat it as something you have to do). The rest should be familiar.</p>
</section>
<section id="a-simple-word-alignment-model">
<h2>A simple word-alignment model<a class="headerlink" href="#a-simple-word-alignment-model" title="Permalink to this heading">#</a></h2>
<p>Okay, as a last example we’ll do a simple word alignment model in the spirit of the IBM models. Note that this will be a <em>supervised</em> model; doing unsupervised stuff is a bit trickier.</p>
<p>Here’s some word alignment data. The dataset is triples of <code class="docutils literal notranslate"><span class="pre">E,</span> <span class="pre">A,</span> <span class="pre">F</span></code> where <code class="docutils literal notranslate"><span class="pre">A[i]</span></code> = list of words <code class="docutils literal notranslate"><span class="pre">E[i]</span></code> aligned to, or <code class="docutils literal notranslate"><span class="pre">[]</span></code> for null-aligned:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_dataset</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;the blue house&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;la maison bleue&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;the house&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;la maison&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;the flower&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s2">&quot;la fleur&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>It’s going to be useful to compute alignment mismatches at the word level between true alignments (like <code class="docutils literal notranslate"><span class="pre">[1,2]</span></code>) and predicted alignments (like <code class="docutils literal notranslate"><span class="pre">[2,3,4]</span></code>). We use intersection-over-union error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">alignmentError</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="n">sys</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span> <span class="o">|</span> <span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span> <span class="o">&amp;</span> <span class="n">s</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span> <span class="o">|</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>And now we can define our structured prediction task. This is also an LDF problem. Basically for each word on the English side, we’ll loop over all possible phrases on the Foreign side to which it could align (maximum phrase length of three). For each of these options we’ll create an example to be fed into the LDF classifier. We also ensure that the same foreign word cannot be covered by multiple English words, though this might not be a good idea in general.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WordAligner</span><span class="p">(</span><span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">):</span>
        <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">pyvw</span><span class="o">.</span><span class="n">SearchTask</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">sch</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">)</span>
        <span class="n">sch</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span>
            <span class="n">sch</span><span class="o">.</span><span class="n">AUTO_HAMMING_LOSS</span> <span class="o">|</span> <span class="n">sch</span><span class="o">.</span><span class="n">IS_LDF</span> <span class="o">|</span> <span class="n">sch</span><span class="o">.</span><span class="n">AUTO_CONDITION_FEATURES</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">makeExample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j0</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;Null&quot;</span> <span class="k">if</span> <span class="n">j0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">F</span><span class="p">[</span><span class="n">j0</span> <span class="o">+</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">example</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="n">E</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
                <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
                <span class="s2">&quot;l&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">),</span>
                <span class="s2">&quot;o&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j0</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">j0</span> <span class="o">-</span> <span class="n">l</span><span class="p">)]</span> <span class="k">if</span> <span class="n">j0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[],</span>
            <span class="p">},</span>
            <span class="n">labelType</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vw</span><span class="o">.</span><span class="n">lCostSensitive</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">lab</span> <span class="o">=</span> <span class="s2">&quot;Null&quot;</span> <span class="k">if</span> <span class="n">j0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">j0</span> <span class="o">+</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">ex</span><span class="o">.</span><span class="n">set_label_string</span><span class="p">(</span><span class="n">lab</span> <span class="o">+</span> <span class="s2">&quot;:0&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ex</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alignedSentence</span><span class="p">):</span>
        <span class="n">E</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="n">alignedSentence</span>

        <span class="c1"># for each E word, we pick a F span</span>
        <span class="n">covered</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># which F words have been covered so far?</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)):</span>
            <span class="n">examples</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># contains vw examples</span>
            <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># contains triples (alignment error, index in examples, [range])</span>

            <span class="c1"># empty span:</span>
            <span class="n">examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">makeExample</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">alignmentError</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[]),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]))</span>

            <span class="c1"># non-empty spans</span>
            <span class="k">for</span> <span class="n">j0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># max phrase length of 3</span>
                    <span class="k">if</span> <span class="n">j0</span> <span class="o">+</span> <span class="n">l</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">F</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">covered</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">j0</span> <span class="o">+</span> <span class="n">l</span><span class="p">):</span>
                        <span class="k">break</span>

                    <span class="nb">id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
                    <span class="n">examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">makeExample</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j0</span><span class="p">,</span> <span class="n">l</span><span class="p">))</span>
                    <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">alignmentError</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="n">j0</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span>
                            <span class="nb">id</span><span class="p">,</span>
                            <span class="nb">range</span><span class="p">(</span><span class="n">j0</span><span class="p">,</span> <span class="n">j0</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="n">sortedSpans</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
                <span class="n">sortedSpans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">sortedSpans</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">oracle</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sortedSpans</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">sortedSpans</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sortedSpans</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="n">oracle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sortedSpans</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sch</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
                <span class="n">examples</span><span class="o">=</span><span class="n">examples</span><span class="p">,</span>
                <span class="n">my_tag</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">oracle</span><span class="o">=</span><span class="n">oracle</span><span class="p">,</span>
                <span class="n">condition</span><span class="o">=</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">)],</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">examples</span><span class="p">:</span>
                <span class="n">ex</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>

            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spans</span><span class="p">[</span><span class="n">pred</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">[</span><span class="n">pred</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">covered</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<p>The only really complicated thing here is computing the oracle. What we do is, for each possible alignment, compute an intersection-over-union error rate. The oracle is then that alignment that achieves the smallest (local) error rate. This is not perfect, but is good enough. One interesting thing here is that now the <code class="docutils literal notranslate"><span class="pre">oracle</span></code> could be a <em>list</em>; this is completely supported by the underlying algorithms.</p>
<p>We can train and test this model to make sure it does the right thing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vw</span> <span class="o">=</span> <span class="n">vowpalwabbit</span><span class="o">.</span><span class="n">Workspace</span><span class="p">(</span>
    <span class="s2">&quot;--search 0 --csoaa_ldf m --search_task hook -q ef -q ep&quot;</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">vw</span><span class="o">.</span><span class="n">init_search_task</span><span class="p">(</span><span class="n">WordAligner</span><span class="p">)</span>
<span class="c1"># BUG: This is currently broken due to incorrect oracle generation. Currently under investigation.#for p in range(10):</span>
<span class="c1">#    task.learn(my_dataset)</span>
<span class="c1"># print(task.predict( (&quot;the blue flower&quot;.split(), ([],[],[]), &quot;la fleur bleue&quot;.split()) ))</span>
</pre></div>
</div>
</div>
</div>
<p>If this worked correctly, it should have printed <code class="docutils literal notranslate"><span class="pre">[[0],</span> <span class="pre">[2],</span> <span class="pre">[1]]</span></code>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "VowpalWabbit/vowpal_wabbit",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./examples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </article>
              


              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="search_sequence.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Search - Sequence</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../reference/index.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">API Reference</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>


<footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    <p class="copyright">
    &copy; Copyright 2021, John langford et al.<br>
</p>
  </div>
  
  <div class="footer-item">
    <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
  </div>
  
</div>
</footer>
<script type="text/javascript" src="https://js.monitor.azure.com/scripts/c/ms.analytics-web-3.min.js">
</script>
<script>
  const analytics = new oneDS.ApplicationInsights();
  var config = {
    instrumentationKey: "734e91f5b0594dd08e2e4768fb4f9655-a7347ca4-1142-4c1e-831a-372cd2790ac0-6806",
    disableCookiesUsage: true,
    webAnalyticsConfiguration: {
      urlCollectHash: true
    }
  };
  analytics.initialize(config, []);
</script>

  </body>
</html>